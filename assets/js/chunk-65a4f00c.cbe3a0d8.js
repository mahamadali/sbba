(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-65a4f00c"],{2678:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ui-wrapper-messaging",{scopedSlots:e._u([{key:"m-title-header",fn:function(){return[s("TitleHeader")]},proxy:!0},{key:"m-user-header",fn:function(){return["personal"===e.mainConversation.type?s("UserHeader"):e._e(),"network"===e.mainConversation.type?s("UserHeaderNetwork"):e._e(),"group"===e.mainConversation.type?s("UserHeaderGroup"):e._e()]},proxy:!0},{key:"m-history",fn:function(){return[s("MessagingHistory",{attrs:{isMain:""}})]},proxy:!0},{key:"m-content",fn:function(){return[e.mainConversation._id?s("ChatContent",{key:e.mainConversation._id,attrs:{isMain:"",setParentMessage:e.setParentMessage,conversation:e.mainConversation}}):s("div",{staticClass:"empty-conversation"},[e._v(" Select a conversation ")])]},proxy:!0},{key:"m-new",fn:function(){return[e.mainConversation._id?s("MessagingNew",{attrs:{parentMessage:e.parentMessage,conversation:e.mainConversation,clearParentMessage:e.clearParentMessage}}):e._e()]},proxy:!0}])})},i=[],n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ui-wrapper-messaging-wr"},[s("div",{staticClass:"ui-wrapper-messaging"},[s("div",{staticClass:"ui-wrapper-messaging__title-header m-title-header"},[e._t("m-title-header")],2),s("div",{staticClass:"ui-wrapper-messaging__user-header m-user-header ui-hide-mobile"},[e._t("m-user-header")],2),s("div",{staticClass:"ui-wrapper-messaging__history m-history"},[e._t("m-history")],2),s("div",{staticClass:"ui-wrapper-messaging__content m-content ui-hide-mobile"},[e._t("m-content")],2),s("div",{staticClass:"ui-wrapper-messaging__new m-new ui-hide-mobile"},[e._t("m-new")],2)])])},r=[],o={name:"UiWrapperMessaging"},c=o,l=(s("e2b8"),s("2877")),u=Object(l["a"])(c,n,r,!1,null,"4627a28a",null),d=u.exports,p=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.conversation.request?s("div",{staticClass:"request-wrapper d-flex flex-column align-items-center p-3"},[e.conversation.lastMessage.userId===e.$store.getters["profile/getProfileId"]?[s("p",{staticClass:"mb-3"},[e._v(" This is a conversation request, "+e._s(e.conversation.user.title)+" must accept it to continue this conversation. ")])]:[s("p",{staticClass:"mb-3"},[e._v(" This is a conversation request, accept to start chatting with "+e._s(e.conversation.user.title)+" ")]),s("div",{staticClass:"d-flex flex-row"},[s("button",{staticClass:"ui-btn mx-2",on:{click:e.acceptRequest}},[e._v("Accept")]),s("button",{staticClass:"ui-btn__outline mx-2",on:{click:e.rejectRequest}},[e._v(" Reject ")])])]],2):s("div",{staticClass:"messaging-new"},[e.parentMessage?s("div",{staticClass:"reply-wrapper"},[s("div",{staticClass:"replay-message"},[s("span",{staticClass:"reply-author"},[e._v(e._s(e.parentMessage.my?"You":e.parentMessage.user.title))]),s("parse-chat",{attrs:{content:e.parentChatContent}})],1),s("div",[s("span",{staticClass:"icon-ic-modal-close",on:{click:e.clearParentMessage}})])]):e._e(),e.files.length?s("div",{staticClass:"attachments-wrapper"},e._l(e.files,(function(t,a){return s("div",{key:t.id,staticClass:"upload-img__box"},[t.uploading?s("div",{staticClass:"upload-img__img-loading"},[s("b-skeleton",{staticClass:"upload-img__img-skeleton"}),s("b-progress",{staticClass:"upload-img__img-progress",attrs:{"show-progress":"",solid:"",max:"100"}},[s("b-progress-bar",{staticClass:"upload-img__img-progress-bar",attrs:{value:t.progress}},[s("span",[s("strong",[e._v(" "+e._s(t.progress)+"% ")])])])],1)],1):["video"===e.fileType(t.file)?s("div",{staticClass:"video-container"},[s("b-embed",{key:t.file.id,staticClass:"upload-img__img p-0",attrs:{type:"video",controls:"",poster:e.videoPoster(t.file),aspect:"0"}},[s("source",{key:t.file.id,attrs:{src:t.file.url}})]),s("button",{staticClass:"ui-btn ui-btn__rounded gallery-btn-delete",on:{click:function(t){return t.preventDefault(),e.removeImage(a)}}},[s("span",{staticClass:"icon-close"})])],1):"image"===e.fileType(t.file)?s("div",{staticClass:"upload-img__img",style:{"background-image":"url('"+t.file.url+"')"}},[s("button",{staticClass:"ui-btn ui-btn__rounded gallery-btn-delete",on:{click:function(t){return t.preventDefault(),e.removeImage(a)}}},[s("span",{staticClass:"icon-close"})])]):"doc"===e.fileType(t.file)?s("div",{staticClass:"upload-img__img"},[e._v(" "+e._s(t.file.name)+" "),s("button",{staticClass:"ui-btn ui-btn__rounded gallery-btn-delete",on:{click:function(t){return t.preventDefault(),e.removeImage(a)}}},[s("span",{staticClass:"icon-close"})])]):e._e()]],2)})),0):e._e(),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],staticClass:"form-control messaging-new__input",attrs:{placeholder:"Write a message...","no-validate":"",disabled:e.isRecording||e.audioNote},domProps:{value:e.message},on:{input:[function(t){t.target.composing||(e.message=t.target.value)},e.handleInput],keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.sendMessage(t))},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.shiftKey?(t.preventDefault(),e.handleShiftEnter(t)):null}}}),e._v(" "),s("div",{staticClass:"messaging-new__actions"},[s("div",{staticClass:"ui-flex ui-flex-grow"},[s("file-upload",{ref:"upload",staticClass:"upload-img__new upload__new--img",attrs:{for:"img-upload-"+e.conversation._id,"input-id":"img-upload-"+e.conversation._id,extensions:e.attachmentParams.extensions,accept:e.attachmentParams.accept,multiple:e.attachmentParams.multiple,directory:e.attachmentParams.directory,thread:e.attachmentParams.thread,drop:e.attachmentParams.drop,"drop-directory":e.attachmentParams.dropDirectory,"add-index":e.attachmentParams.addIndex},on:{"input-file":e.inputFile,"input-filter":e.inputFilter}},[s("base-icon-button",{style:{marginTop:"4px"},attrs:{icon:e.attachmentIcon,width:16,isImg:""}})],1),s("base-icon-button",{style:{display:"none"},attrs:{icon:e.powerIcon,isImg:""}}),e.audioNote?s("div",{staticClass:"remove-audio-note",on:{click:e.clearAudioNote}},[s("base-icon-button",{style:{marginTop:"4px"},attrs:{icon:e.deleteIcon,width:16,isImg:""}})],1):s("audio-recorder",{ref:"audioRecorder",style:{padding:"4px 0",marginTop:"4px"},attrs:{filename:"Recording",format:"wav",time:5,"bit-rate":192},on:{toggleRecord:e.onRecorderToggle,recordingReady:e.onRecordingReady}}),s("div",{staticClass:"ui-flex-grow ui-relative"},[e.audioNote?s("div",{staticClass:"ui-flex ui-flex-grow align-items-center"},[s("audio-player",{staticClass:"ui-flex-grow",style:{marginRight:"32px"},attrs:{record:e.audioNote}})],1):e._e(),e.isRecording?s("div",{style:{lineHeight:"40px",marginLeft:"12px"}},[e._v(" "+e._s(e.recordedTime)+" ")]):e._e()])],1),s("button",{staticClass:"ui-btn",attrs:{disabled:!e.message.length&&!e.audioNote&&!e.media.length||e.isSending},on:{click:e.sendMessage}},[e._v("Send")])])]),s("error-modal",{ref:"showErrorModal",attrs:{id:"error-modal-chat-"+e.conversation._id,modalMessage:e.modalMessage,modalMessageType:e.modalMessageType,generalError:e.generalError},on:{uploadAnotherFile:e.uploadFile}})],1)},g=[],m=s("1da1"),f=(s("b0c0"),s("2b3d"),s("d3b7"),s("3ca3"),s("ddb0"),s("a434"),s("96cf"),s("2ef0")),h=s("f367"),v=s("1043"),b=s.n(v),_=s("6b48"),y=s.n(_),C=s("f69e"),w=s.n(C),k=s("8019"),x=s.n(k),M=s("708e"),R=s("17ff"),$=s("37b9"),T=s("c382"),I={name:"MessagingNew",components:{BaseIconButton:h["default"],FileUpload:x.a,ErrorModal:R["default"],AudioRecorder:$["a"],AudioPlayer:T["a"]},props:{placeholder:String,parentMessage:Object,clearParentMessage:Function},computed:{conversation:function(){return this.$store.getters["chat/getMainConversation"]},parentChatContent:function(){return this.$options.filters.truncate(this.parentMessage.content,100)},recordedTime:function(){return this.$refs.audioRecorder.recordedTime}},filters:{truncate:function(e,t){return e.substring(0,Math.min(t,e.length))+(t<e.length?"...":"")}},mounted:function(){document.querySelector(":root").style.setProperty("--TagTextColor","red")},data:function(){return{message:"",isSending:!1,typing:!1,skipTypingNotification:!1,attachmentIcon:b.a,powerIcon:y.a,deleteIcon:w.a,modalMessageType:"",generalError:!1,minSize:1024,modalMessage:"",files:[],media:[],replacedData:[],uploading:!1,attachmentParams:{extensions:"gif,jpg,jpeg,png,webp,mp4,mkv,avi,.pdf,.doc,.docx",accept:"image/png,image/gif,image/jpeg,image/webp, video/mp4,video/x-m4v,video/*,.pdf,.doc,.docx",minSize:1024,size:209715200,videoSize:1048576e3,multiple:!1,directory:!1,drop:!1,dropDirectory:!1,createDirectory:!1,addIndex:!1,thread:3},isRecording:!1,audioNote:null}},methods:{handleShiftEnter:function(){this.message+="\n"},onFocus:function(){this.$refs.postField.$el.focus()},sendMessage:function(){var e=this;return Object(m["a"])(regeneratorRuntime.mark((function t(){var s,a,i,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,s=e.$store.getters["chat/getMainConversation"]._id,a=e.message,i=e.media,n=e.parentMessage,!e.audioNote){t.next=9;break}return t.next=6,e.$store.dispatch("profile/uploadImage",{newFile:e.audioNote.blob});case 6:r=t.sent,i.push({file:r,order:1}),a="Audio Note";case 9:e.$store.dispatch("chat/sendMessage",{conversationId:s,message:a,media:i,parentMessage:n?n._id:null}),e.typing=!1,e.skipTypingNotification=!0,e.$store.dispatch("chat/notifyTyping",{conversationId:s,isTyping:!1}),e.message="",e.clearParentMessage(),e.clearAudioNote(),e.resetMedia(),t.next=23;break;case 19:throw t.prev=19,t.t0=t["catch"](0),console.log(t.t0.response),t.t0;case 23:e.isSending=!1;case 24:case"end":return t.stop()}}),t,null,[[0,19]])})))()},acceptRequest:function(){var e=this;return Object(m["a"])(regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s=e.conversation._id,t.next=3,e.$store.dispatch("chat/manageConversationRequest",{conversationId:s,type:"accept"});case 3:case"end":return t.stop()}}),t)})))()},rejectRequest:function(){var e=this;return Object(m["a"])(regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s=e.conversation._id,t.next=3,e.$store.dispatch("chat/manageConversationRequest",{conversationId:s,type:"reject"});case 3:case"end":return t.stop()}}),t)})))()},handleInput:Object(f["debounce"])((function(){if(this.skipTypingNotification)this.skipTypingNotification=!1;else if(!this.conversation.isNew){var e=this.conversation._id;this.typing=!this.typing,this.$store.dispatch("chat/notifyTyping",{conversationId:e,isTyping:this.typing})}}),3e3,{leading:!0}),uploadFile:function(){this.$refs.upload[0].click()},fileType:function(e){return"image/"===e.type.substr(0,6)?"image":"video/"===e.type.substr(0,6)?"video":"doc"},inputFile:function(e,t){var s=this;return Object(m["a"])(regeneratorRuntime.mark((function a(){var i,n,r,o,c,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!e||t){a.next=14;break}if(s.uploading||(s.uploading=!0),!(e.size>=0&&e.size<s.attachmentParams.videoSize)){a.next=14;break}return i=s.media.length+1,n=s.files.push({file:null,order:i,uploading:!0,progress:0}),r=500,o=setInterval((function(){s.files[n-1].progress<90?s.files[n-1].progress+=10:s.files[n-1].progress<99&&(s.files[n-1].progress+=3,r=1e3)}),r),s.media.push({file:null,order:i}),a.next=10,s.$store.dispatch("profile/uploadImage",{newFile:e});case 10:c=a.sent,l=s.fileType(e.file),"video"!==l?(s.media[n-1].file=c,s.files[n-1].file=e,s.files[n-1].progress=100,setTimeout((function(){s.files[n-1].uploading=!1,clearInterval(o)}),1e3)):setTimeout((function(){s.media[n-1].file=c,s.files[n-1].file=e,s.files[n-1].progress=100,setTimeout((function(){s.files[n-1].uploading=!1,clearInterval(o)}),1e3)}),2e3),s.uploading&&(s.uploading=!1);case 14:case"end":return a.stop()}}),a)})))()},inputFilter:function(e,t,s){var a=this;return Object(m["a"])(regeneratorRuntime.mark((function i(){var n,r;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(!e||t){i.next=26;break}if(!(e.size>=0&&e.size>a.attachmentParams.videoSize)){i.next=6;break}return a.modalMessageType="error",a.modalMessage="Upload is too large, it can't be more than 1GB",a.$nextTick((function(){a.$refs.showErrorModal.onShow(),a.$nextTick((function(){a.$bvModal.show("error-modal")}))})),i.abrupt("return",s());case 6:if(a.$refs.showErrorModal.onHide(),!/(\/|^)(Thumbs\.db|desktop\.ini|\..+)$/.test(e.name)){i.next=9;break}return i.abrupt("return",s());case 9:if(!/\.(php5?|html?|jsx?)$/i.test(e.name)){i.next=11;break}return i.abrupt("return",s());case 11:if(!e||""!==e.error||!e.file||t&&e.file===t.file){i.next=26;break}if(e.blob="",n=window.URL||window.webkitURL,n&&(e.blob=n.createObjectURL(e.file)),e.url="",!e.blob||"image/"!==e.type.substr(0,6)){i.next=20;break}e.url=e.blob,i.next=26;break;case 20:if(!e.blob||"video/"!==e.type.substr(0,6)){i.next=26;break}return i.next=23,Object(M["a"])(e.blob,{quality:.6});case 23:r=i.sent,e.url=e.blob,e.poster=r[1].blob;case 26:case"end":return i.stop()}}),i)})))()},removeImage:function(e){this.files.splice(e,1),this.media.splice(e,1)},resetMedia:function(){this.files=[],this.media=[]},onRecorderToggle:function(){this.isRecording=!this.isRecording},onRecordingReady:function(e){this.audioNote=e},clearAudioNote:function(){console.log("clear audio note"),this.audioNote=null}}},N=I,P=(s("d1e2"),Object(l["a"])(N,p,g,!1,null,"03667bf5",null)),j=P.exports,O=s("f593"),E=s("8594"),S=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"messaging-user-header",on:{click:function(t){return e.goToProfile(e.conversation.user.handle)}}},[s("div",{staticClass:"messaging-user-header__profile-img"},[s("img",{staticClass:"user-image clickable",attrs:{src:e.conversation.user.picture?e.conversation.user.picture.formats&&e.conversation.user.picture.formats.thumbnail?e.conversation.user.picture.formats.thumbnail.url:e.conversation.user.picture.url:e.userIcon}}),e.userOnline?s("span",{staticClass:"user-status user-status--online"}):e._e()]),s("div",{staticClass:"messaging-user-header__profile-title"},[s("p",{staticClass:"user-name clickable"},[e._v(" "+e._s(e.conversation.user.title)+" ")])])])},U=[],H=s("77f0"),F=s.n(H),q={name:"UserHeader",data:function(){return{userIcon:F.a}},computed:{conversation:function(){return this.$store.getters["chat/getMainConversation"]},userOnline:function(){return this.$store.getters["chat/getUsersOnlineStatus"][this.conversation.user.id]}},methods:{goToProfile:function(){this.$router.push({path:"/profiles/".concat(this.conversation.user.handle)})}}},z=q,D=Object(l["a"])(z,S,U,!1,null,null,null),A=D.exports,B=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"messaging-title-header"},[s("base-icon-button",{staticClass:"messaging-title-header__button ui-hide-none-mobile",attrs:{icon:"icon-ic-arrow-back"}}),s("h2",{staticClass:"messaging-title-header__text"},[e._v("Messaging")]),s("base-icon-button",{staticClass:"messaging-navbar-menu-header__button--edit",attrs:{icon:"icon-edit-box"},on:{iconClicked:e.composeMessage}})],1)},L=[],K=(s("25f0"),{name:"TitleHeader",components:{BaseIconButton:h["default"]},methods:{composeMessage:function(){this.$store.dispatch("chat/openFloatingConversation",{conversation:{windowId:Math.random().toString(36).substring(2,15),user:null,isNew:!0,type:"personal"},isOpen:!0})}}}),G=K,W=Object(l["a"])(G,B,L,!1,null,null,null),J=W.exports,Y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"messaging-user-header"},[e._m(0),e._m(1),s("div",{staticClass:"messaging-user-header__more"},[s("base-icon-dropdown",{staticClass:"messaging-user-header__more-button",attrs:{"no-caret":"",right:""}},[s("base-list-item-default",{attrs:{icon:"icon-follow"}},[e._v(" Add member ")]),s("base-list-item-default",{attrs:{icon:"icon-follow"}},[e._v(" Remove member ")]),s("base-list-item-default",{attrs:{icon:"icon-follow"}},[e._v(" Members ")]),s("base-list-item-default",{attrs:{icon:"icon-follow"}},[e._v(" Leave group ")]),s("base-list-item-default",{attrs:{icon:"icon-follow"}},[e._v(" Mute group ")]),s("base-list-item-default",{attrs:{icon:"icon-follow"}},[e._v(" Rename group ")]),s("base-list-item-default",{attrs:{icon:"icon-follow"}},[e._v(" Block member ")]),s("base-list-item-default",{attrs:{icon:"icon-follow"}},[e._v(" Delete chat ")])],1)],1)])},Q=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"messaging-user-header__profile-img messaging-user-header__profile-img--group"},[s("img",{staticClass:"user-image",attrs:{src:"https://bizfluence-media.nyc3.cdn.digitaloceanspaces.com/9f683c62d2136a2cbd2a147ef97d6cea.jpg"}}),s("img",{staticClass:"user-image",attrs:{src:"https://bizfluence-media.nyc3.cdn.digitaloceanspaces.com/949d2dbaf9af78300b4a4b9c645efba9.jpg"}})])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"messaging-user-header__profile-title"},[s("p",{staticClass:"user-name clickable"},[e._v(" Team Work ")]),s("p",{staticClass:"user-extra"},[e._v(" 03 Members ")])])}],V=s("b65d"),X=s("8f1b"),Z={name:"UserHeaderGroup",components:{BaseListItemDefault:X["a"],BaseIconDropdown:V["a"]}},ee=Z,te=Object(l["a"])(ee,Y,Q,!1,null,null,null),se=te.exports,ae=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"messaging-user-header"},[s("div",{staticClass:"messaging-user-header__profile-img messaging-user-header__profile-img--network"},[s("img",{staticClass:"user-image",attrs:{src:e.conversation.network.banner?e.conversation.network.banner.url:e.defaultNetworkIcon}})]),s("div",{staticClass:"messaging-user-header__profile-title"},[s("p",{staticClass:"user-name clickable"},[e._v(" "+e._s(e.conversation.network.name)+" ")])]),s("div",{staticClass:"messaging-user-header__more"})])},ie=[],ne=s("522f"),re=s.n(ne),oe={name:"UserHeaderNetwork",data:function(){return{defaultNetworkIcon:re.a}},computed:{conversation:function(){return this.$store.getters["chat/getMainConversation"]}}},ce=oe,le=Object(l["a"])(ce,ae,ie,!1,null,null,null),ue=le.exports,de={name:"Messaging",components:{UserHeaderNetwork:ue,UserHeaderGroup:se,TitleHeader:J,UserHeader:A,MessagingHistory:E["default"],ChatContent:O["a"],MessagingNew:j,UiWrapperMessaging:d},computed:{mainConversation:function(){return this.$store.getters["chat/getMainConversation"]}},data:function(){return{parentMessage:null}},destroyed:function(){this.$store.dispatch("chat/resetMainConversation")},methods:{setParentMessage:function(e){this.parentMessage=e},clearParentMessage:function(){this.parentMessage=null}},beforeRouteEnter:function(e,t,s){s((function(e){var t=e.$route.params.conversationId;!t||e.$store.getters["chat/getMainConversation"]._id||e.$store.dispatch("chat/selectMainConversation",{_id:t})}))},beforeRouteLeave:function(e,t,s){this.$store.dispatch("chat/resetMainConversation"),s()}},pe=de,ge=(s("d16a"),Object(l["a"])(pe,a,i,!1,null,"2b82ef76",null));t["default"]=ge.exports},5748:function(e,t,s){},a0e8:function(e,t,s){},af60:function(e,t,s){},d16a:function(e,t,s){"use strict";s("5748")},d1e2:function(e,t,s){"use strict";s("a0e8")},e2b8:function(e,t,s){"use strict";s("af60")}}]);